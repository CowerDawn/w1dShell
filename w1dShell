#!/bin/bash
clear
forbidden_commands=("sudo" "su" "doas" "pkexec" "systemctl" "mount" "umount" "dd" "fdisk" "gdisk" "parted" "mkfs" "fsck" "chown" "chmod" "chgrp" "passwd" "visudo" "adduser" "deluser" "addgroup" "delgroup" "reboot" "shutdown" "poweroff" "halt")

is_forbidden() {
    local cmd=$1
    for forbidden in "${forbidden_commands[@]}"; do
        if [[ "$cmd" == "$forbidden" ]]; then
            return 0
        fi
    done
    return 1
}

shut() {
    echo "Shutting down the system..."
    sudo shutdown -h now
}

openp() {
    local program=$1
    echo "Opening $program..."
    $program &
}

closep() {
    local program=$1
    echo "Closing $program..."
    pkill -f $program
}

while true; do
    # Вывод приглашения
    read -p "w1dShell> " input

    read -ra cmd <<< "$input"

    if is_forbidden "${cmd[0]}"; then
        echo "Error: Command '${cmd[0]}' is forbidden."
    else
        case "${cmd[0]}" in
            shut)
                shut
                ;;
            openp)
                if [[ -n "${cmd[1]}" ]]; then
                    openp "${cmd[1]}"
                else
                    echo "Usage: openp <program>"
                fi
                ;;
            closep)
                if [[ -n "${cmd[1]}" ]]; then
                    closep "${cmd[1]}"
                else
                    echo "Usage: closep <program>"
                fi
                ;;
            exit)
                echo "Exiting w1dShell..."
                exit 0
                ;;
            *)
                eval "$input"
                ;;
        esac
    fi
done
